<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>beardsec</title><link>http://beardsec.com/</link><description></description><atom:link href="http://beardsec.com/rss.xml" rel="self"></atom:link><lastBuildDate>Fri, 21 Feb 2014 00:00:00 -0800</lastBuildDate><item><title>Encounters with CSRF</title><link>http://beardsec.com/security/encounters-with-csrf</link><description>&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Cross-site request forgery, mostly commonly known as CSRF is by far one of my favorite web application attacks. Over the past several years I have been lucky enough to get written permission to perform vulnerability assessments on a large amount of really interesting web applications.  CSRF is something preach about to my clients, and one of my most commonly discovered vulnerabilities.&lt;/p&gt;
&lt;p&gt;CSRF works best as a targeted attack or as a result of a stored injection attack.  It relies on a victim being logged into a vulnerable web application and them clicking on a specially crafted link.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="links-for-everyone"&gt;
&lt;h2&gt;Links for Everyone!&lt;/h2&gt;
&lt;p&gt;Let's say that a user is logged into their favorite social networking website where links being flung around wildly and the user base is less than tech savvy. This pretend social networking site also decided to not require the user to enter their current password when they want to create a new one. Since anyone can join this site, post content, and add people as their &amp;quot;friends&amp;quot;, the resident basement script kiddie sets up a fake account and pokes around. He finds a co-worker that has been giving him a really hard time and evil thoughts cross his mind.  The bad guy knows how easy CSRF vulnerabilities are to discover so he starts with the keys to the kingdom, the password reset page.  He notices that the only fields being passed in the POST request are the new password and a confirmation of the new password so he crafts up this basic HTML page and throws it up on his server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
     &lt;span class="nt"&gt;&amp;lt;form&lt;/span&gt; &lt;span class="na"&gt;action=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://socialbutterfly.com/Users/JerkCoWorker/password_reset&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;POST&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;hidden&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;newpass&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;G0tcha!&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;hidden&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;newpass_confirm&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;G0tcha!&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;image&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;clickme.png&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit request&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
 &lt;span class="nt"&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;He then posts a link to his co-workers wall or sends him a private message with the following deceptively sly image.&lt;/p&gt;
&lt;img alt="http://beardsec.com/images/clickhere.jpg" class="align-center" src="http://beardsec.com/images/clickhere.jpg" style="width: 340px; height: 292px;" /&gt;
&lt;p&gt;This image is not what it seems. When clicked, it executes the HTML POST request on behalf of the victim. Since there is no CSRF token or any value only known to the user (such as the current password), the victims password is changed to G0tcha! and the basement hacker wins, he is able to log into his co-workers account and wreak havoc on his co-workers social life.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="mitigations"&gt;
&lt;h2&gt;Mitigations&lt;/h2&gt;
&lt;p&gt;This is a pretty simple example, CSRF can get quite complex. While the majority of your sensitive actions in a web application are performed over a POST request, I have encountered GET requests that download files or perform other actions. Take the following URL for example.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;GET https://topsecretfilesharingapp.com/download/filemightbemalicious.exe
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Since downloads are being handled via a GET request and the application might not be handling malicious file uploads in a secure manner, we can force a user to download an executable or Java file just by having them click on a link.&lt;/p&gt;
&lt;p&gt;There are a few ways to actually combat the CSRF attack, all of them require a special, private piece of information that only the user knows or can prove that the request is actually coming from that page with the valid user iniating that action.  Below is a list of mitigations ranked from most logical and invisible to the end user to the worst possible UX ever and should be avoided at all costs.&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;CSRF Tokens in HTTP Requests - This is the most common mitigation to CSRF attacks and thankfully is becoming easier to implement in popular frameworks such as Django and Ruby on Rails.  This works by having a hidden field in requests that is tied to the users current session. It is also possible to implement a new, random CSRF token per request but issues may arise with using the back button while logged in to the application.  With a CSRF token in place, even if a malicious user were to send an unsuspecting person a link the transaction would not go through because the server denies any request lacking a CSRF token or with the incorrect CSRF token value.:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;form&lt;/span&gt; &lt;span class="na"&gt;action=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/changepassword.php&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
         &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;hidden&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CSRFToken&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;OWY4NmQwODE4ODRjN2A90WEwYzU1YWQwMTVhM2JmNGYxYjJiMGI4MjJjZDE1ZDZjMTVi&lt;/span&gt;
&lt;span class="s"&gt; MGYwMGEwOA==&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
 &lt;span class="nt"&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It should be mentioned that passing this value in the URL does in fact work to protect against CSRF attacks. But as a security guy I cringe when I see any token in the URL. Keep sensitive data away from the URL. What if someone copy and pastes a link to a co-worker or an internal WAF/ Reverse Proxy can grab the token?  It's better to keep it away from prying eyes.&lt;/p&gt;
&lt;ol class="arabic simple" start="2"&gt;
&lt;li&gt;Header checking - Having the server check for an HTTP referrer header or origin header can be an effective way to mitigate CSRF attacks and has been used for quite some time in embedded devices that do not necessarily rely on sessions.  These methods are helpful but do present challenges such as redirect vulnerabilities and URL spoofing.  Use header checking sparingly, only if CSRF tokens are an impossible feat.&lt;/li&gt;
&lt;li&gt;Challenge - Response- If you want to scare your users away from your shiny new web application make them answer a Captcha on every sensitive request.  While making users enter their password or a unique Captcha per request can mitigate CSRF attacks, why do it?  There are better options than this. That is all.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;There you have it, my thoughts on CSRF and why it is awesome.  Go fire up an intercepting proxy and build some proof of concept HTML pages and hack away. Legally, of course.&lt;/p&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jimmy</dc:creator><pubDate>Fri, 21 Feb 2014 00:00:00 -0800</pubDate><guid>tag:beardsec.com,2014-02-21:security/encounters-with-csrf</guid><category>CSRF</category><category>Attacks</category><category>OWASP</category><category>Penetration Testing</category></item><item><title>iPhone woes</title><link>http://beardsec.com/rambling/iphone-woes</link><description>&lt;p&gt;A few months back I took the plunge into the pre-paid phone world with a very beat up iPhone 4 that was a freebie from a friend. After a few months, I was gifted a very mint 4S from my recently tech savvy parents. This upgrade forced a switch from StraightTalk (who uses the AT&amp;amp;T network) to Ting mobile, a Sprint based cellular company.  In the process of getting the phone setup I ran into a massive glitch, the infamous iOS 7 Wi-Fi &amp;quot;grey out&amp;quot; issue.  Basically, for some reason the Wi-Fi chip thinks that it is overheated and disables its functionality, making it impossible to reliably join and stay connected to any Wi-Fi network. This was a deal breaker for me and since I already scrapped the old phone for parts, I needed to figure out a solution. After scouring Apple discussion boards and searching around I discovered a Canadian blog post about overheating your phone on purpose then cooling it down quickly which restores the wireless chip back to its operational state.&lt;/p&gt;
&lt;p&gt;This sounds wacky, but I was desperate. I grabbed a hair drier, cranked it up, and pointed it near the Wi-Fi chip. After about 6 minutes or so, the phone gave me a warning that the phone needs to cool down.&lt;/p&gt;
&lt;img alt="http://beardsec.com/images/overheat.jpg" class="align-center" src="http://beardsec.com/images/overheat.jpg" style="width: 213px; height: 378px;" /&gt;
&lt;p&gt;Voila! I successfully overheated my brand new phone. From what I gather, this sends a hard reset to the Wi-Fi chip bringing it back to its non-buggy state and brings the Wi-Fi back to a normal operating state.  I did put the phone in the refrigerator after for a bit to bring it back to life but I don't think this is totally necessary.&lt;/p&gt;
&lt;p&gt;It's been a few weeks now and things are running without a hitch. I am in and out of 3 or 4 networks a day and have not run into any issues.  Anyone dealing with the horrid Wi-Fi issue that iOS 7 presents to some phones, give this a shot. What else do you have to lose?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jimmy</dc:creator><pubDate>Fri, 07 Feb 2014 00:00:00 -0800</pubDate><guid>tag:beardsec.com,2014-02-07:rambling/iphone-woes</guid><category>DIY</category><category>iphone</category><category>hacks</category></item><item><title>Up and Running</title><link>http://beardsec.com/rambling/up-and-running</link><description>&lt;p&gt;Well here it is.  I've been having a lot of security and technology things on my mind recently and figured I needed a new excuse to buy a ridiculous domain name, learn Hyde, and get to spend some quality time in my favorite editor, Sublime Text.  If you are reading this I assume you probably know me and what I do for a living. This blog is going to be an informal place for me to lay out some of my thoughts and experiments in application and network security as well as to document my ongoing journey to becoming a halfway decent developer.  I'll be talking about Python things, security ramblings, web development, and the occasional beard pun.  Thanks for tuning in.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jimmy</dc:creator><pubDate>Thu, 30 Jan 2014 00:00:00 -0800</pubDate><guid>tag:beardsec.com,2014-01-30:rambling/up-and-running</guid><category>welcome</category></item></channel></rss>